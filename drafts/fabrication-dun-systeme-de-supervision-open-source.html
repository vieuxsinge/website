<!DOCTYPE HTML>
<html lang="fr" prefix="og: http://ogp.me/ns#">
  <head>
    <title>Brasserie du Vieux Singe — Fabrication d'un système de supervision open source</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="https://www.vieuxsinge.com/theme/css/main.css" />
    <!--[if lte IE 8]><script src="https://www.vieuxsinge.com/theme/js/ie/html5shiv.js"></script><![endif]-->
    <!--[if lte IE 8]><link rel="stylesheet" href="https://www.vieuxsinge.com/theme/css/ie8.css" /><![endif]-->
    <!--[if lte IE 9]><link rel="stylesheet" href="https://www.vieuxsinge.com/theme/css/ie9.css" /><![endif]-->
    <link href="https://www.vieuxsinge.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Brasserie du Vieux Singe Full Atom Feed" />
    <link rel="icon" type="image/png" href="https://www.vieuxsinge.com/theme/images/favicon.png" />
  </head>
  <body>
    <!-- Page Wrapper -->
      <div id="page-wrapper">

        <!-- Header -->
            <header id="header">
            <h1>
              <img src="https://www.vieuxsinge.com/theme/images/logo_min.png">
              <a href="/">Brasserie du Vieux Singe</a>
            </h1>
            <nav class="menu-wide">
                <a href="/index.html">Accueil</a>
                <a href="/index.html#bieres">Bières</a>
                <a href="/manifeste.html">Manifeste</a>
                <a href="/blog.html">Actus</a>
                <a href="https://boutique.vieuxsinge.com">Drive</a>
                <a href="/index.html#infospratiques">Infos pratiques</a>
            </nav>
            <nav class="menu-mobile">
                <a href="/manifeste.html">Manifeste</a>
                <a href="/blog.html">Actus</a>
                <a href="https://boutique.vieuxsinge.com">Drive</a>
            </nav>
          </header>
        

<!-- Wrapper -->
	<section id="wrapper">

		<!-- Content -->
			<div class="wrapper style1">

				<header class="article">
					<div class="image"><img src="/images/supervision/graphs.jpg" alt="" /></div>
					<div class="inner">
						<p class="date">01 septembre 2020</p>
						<h2 class="major">
							Fabrication d'un système de supervision open source
							<span>Mise en place d'un système de supervision et d'alerte pour le suivi de nos températures de fermentation</span>
						</h2>
					</div>
				</header>

				<div class="inner">
					<blockquote>
<p>Cet article est un retour sur la fabrication d'un système de supervision et les choix associés.<br>
Pour les détails techniques, <a href="https://github.com/vieuxsinge/supervision">tout est publié sous licence libre</a>.</p>
</blockquote>
<p>Les conséquences d'un souci sur notre système de froid peuvent-être assez pénibles, qui vont des esters non souhaités (dus à une fermentation trop chaude) à un chamboulement sur nos plannings de prod (du à une garde à froid interrompue).</p>
<p>Au fur et à mesure, nous avons fait évoluer nos pratiques, d'un début où nous passions à la brasserie les week-end pour nous assurer que tout allait bien, a un système de supervision qui nous envoie des textos quand une anomalie est détectée, avec un suivi automatisé des températures de fermentation.</p>
<h1>Principe</h1>
<p>Chez nous, la température est contrôlée par un groupe-froid relié à des thermostats. Nous avons mis en place un système pour pouvoir suivre l'évolution des températures au fil du temps, avec la possibilité d'accéder à ces données lorsqu'on est pas à la brasserie.</p>
<p>Les thermostats se connectent à notre réseau Wifi et envoient des mesures à un système qui nous permet de les visionner.</p>
<p><img alt="Courbes de Cold Crash d'une de nos bières" src=""></p>
<p>En plus de visualiser les courbes de températures, nous avons mis en place un système d'alertes, qui nous envoie un SMS quand une anomalie est détectée.</p>
<p><img alt="Capture d'un SMS" src=""></p>
<h1>Concrètement, comment ça marche ?</h1>
<p>Nous avions déjà des thermostats pour gérer la température de fermentation, nous avons donc :</p>
<ol>
<li>Modifié le thermostat en lui même, pour qu'il puisse envoyer les mesures à notre système de suivi ;</li>
<li>Mis un place un système pour stocker ces données et les visualiser ;</li>
<li>Ainsi qu'un système pour les analyser et nous alerter en cas de besoin.</li>
</ol>
<h2>Thermostat Wifi</h2>
<p>On utilise des thermostats <em>STC-1000</em> pour gérer la température : ils ont l'avantage — en plus d'être très bon marché — d'être pilotables <a href="https://github.com/matsstaff/stc1000p">par un code alternatif</a>, qui permet de spécifier des profils de fermentation par paliers, du type « reste à 16°C durant 3h, puis passe à 17°C durant 24h, etc. ».</p>
<p>Nous avions besoin que le thermostat puisse transmettre ses données, nous avons donc connecté un module Wifi (un <em>ESP8266</em>) sur le thermostat, puis réalisé <a href="https://github.com/vieuxsinge/stc1000esp">le code qui permet de communiquer avec le STC1000</a>.</p>
<p>Ce code permet :</p>
<ul>
<li>d'<strong>envoyer les informations de température à un système de suivi</strong>,</li>
<li>de <strong>piloter les consignes de température à distance</strong>.</li>
</ul>
<p>Nous ne rentrons volontairement pas dans les détails techniques de la mise en place de ce système dans cet article, mais tous les détails <a href="https://github.com/vieuxsinge/supervision">sont disponibles</a> si vous souhaitez reproduire notre installation.</p>
<h2>Agrégation des données, affichage et alertes</h2>
<p>Le thermostat envoie ses données a un serveur, qui va s'occuper de les stocker, de les analyser et de les afficher. On ne s'étends pas trop sur les choix techniques ici, mais :</p>
<ul>
<li>Les données sont envoyées au serveur qui va les stocker ;</li>
<li>Elles sont analysées régulièrement à la recherche d'anomalies, grâce a <a href="https://github.com/vieuxsinge/supervision">un code développé pour l'occasion</a>. Si besoin, ce code nous envoie des SMS.</li>
<li>Il est possible de venir visualiser l'ensemble des données stockées grâce à une interface dédiée.</li>
</ul>
<h2>Coût</h2>
<p>Pour vous donner un ordre d'idée de ce que nous a coûté cette installation, le serveur que nous utilisons nous coûte 3€/mois, un thermostat coûte XX€ et le module Wifi XX#. Et un peu d'huile de coude ;-)</p>
<p>Si vous souhaitez installer les mêmes outils que nous, <a href="">l'ensemble de la procédure est documentée ici</a>.</p>
<p>Voilà qui devrait vous permettre de suivre vos fermentations de manière un peu plus sereine !</p>
				</div>
			</div>

	</section>


        <!-- Contact -->
          <section id="contact" class="inverse">
            <div class="inner">
              <h2 class="major">Contactez-nous</h2>
              <ul class="contact">
                <li class="fa-home">
                  <strong>Brasserie du Vieux Singe</strong><br />
                  4b rue Janig Corlay<br />
                  35136 St Jacques de la lande
                </li>
                <li class="fa-phone">
                  <a href="tel:0674785489">06 74 78 54 89 (Alexis)</a><br />
                </li>
                <li class="fa-clock-o">
                  <strong>Le magasin est ouvert le vendredi de 10h à 17h. <br />Possibilité de <a href="https://boutique.vieuxsinge.com">commander en ligne</a> (avant jeudi midi)</strong> 
                </li>
              </ul>
              <ul class="contact">
                <li class="fa-envelope"><a href="mailto:contact — at — vieuxsinge.com">contact — at — vieuxsinge.com</a></li>
                  <li class="fa-newspaper-o">
                    <a href="//vieuxsinge.us14.list-manage.com/subscribe/post?u=ecec080a5e9aa46166b5ff3bb&amp;id=291587aeda">
                      Recevoir la newsletter de la brasserie
                    </a>
                  </li>
                <li class="fa-facebook"><a href="http://facebook.com/vieuxsinge.beer">Nous suivre sur Facebook</a></li>
                <li class="fa-twitter"><a href="http://twitter.com/vxsinge">Nous suivre sur Twitter</a></li>
                <li class="fa-instagram"><a href="http://instagram.com/vieuxsinge.beer">Instagram</a></li>
              </ul>

              <ul class="copyright">
                <li><i class="fa fa-copyright fa-flip-horizontal"></i> Brasserie du Vieux Singe</li>
                <li>Design basé sur un travail de <a href="http://html5up.net">HTML5 UP</a></li>
                <li>Illustrations et étiquettes : <a href="http://loic-gosset.com/">Loïc Gosset</a></li>
                <li class="small">SARL au capital social de 20 000 €</li>
                <li class="small">SIRET: 83326256100016</li>
                <li class="small">TVA intracommunautaire: FR16833262561</li>

              </ul>
            </div>
          </section>

      </div>

    <!-- Scripts -->
      <script src="https://www.vieuxsinge.com/theme/js/skel.min.js"></script>
      <script src="https://www.vieuxsinge.com/theme/js/jquery.min.js"></script>
      <script src="https://www.vieuxsinge.com/theme/js/jquery.scrollex.min.js"></script>
      <script src="https://www.vieuxsinge.com/theme/js/util.js"></script>
      <!--[if lte IE 8]><script src="https://www.vieuxsinge.com/theme/js/ie/respond.min.js"></script><![endif]-->
      <script src="https://www.vieuxsinge.com/theme/js/main.js"></script>

  </body>
</html>